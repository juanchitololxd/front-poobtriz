"use strict";(self.webpackChunkFront_web=self.webpackChunkFront_web||[]).push([[214],{6214:(S,x,c)=>{c.r(x),c.d(x,{GameModule:()=>s});var l=c(6895),e=c(8256);class b{constructor(){}}b.\u0275fac=function(o){return new(o||b)},b.\u0275prov=e.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"});var h=c(241),_=c(3560),C=c(7186),v=c(9613),k=c(4235),w=c(7224),y=c(805),R=c(8235);function O(n,o){if(1&n&&(e.TgZ(0,"div",1)(1,"span"),e._UZ(2,"p-progressBar",2),e.TgZ(3,"strong"),e._uU(4),e.qZA()()()),2&n){const t=e.oxw();e.xp6(4),e.Oqu(t.message)}}class g{constructor(){this.blocked=!1}}g.\u0275fac=function(o){return new(o||g)},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-blocked"]],inputs:{blocked:"blocked",message:"message"},decls:1,vars:1,consts:[["class","block",4,"ngIf"],[1,"block"],["mode","indeterminate"]],template:function(o,t){1&o&&e.YNc(0,O,5,1,"div",0),2&o&&e.Q6J("ngIf",t.blocked)},dependencies:[l.O5,R.k],styles:[".block[_ngcontent-%COMP%]{margin-top:15%;margin-inline:15%}.block[_ngcontent-%COMP%] > span[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{font-size:30px;margin-inline:13%}"]});const P=function(n,o,t,a,r,i,u,f){return{square:!0,"border-left":n,"border-right":o,"border-top":t,"border-bottom":a,"no-left":r,"no-right":i,"no-top":u,"no-bottom":f}};function T(n,o){if(1&n&&(e.TgZ(0,"span"),e._UZ(1,"div",2),e.qZA()),2&n){const t=o.$implicit,a=o.index,r=e.oxw().index,i=e.oxw();e.xp6(1),e.Tol(i.buffo&&i.buffo.x==a&&i.buffo.y==r?i.buffo.tipo:""),e.Udp("background",t)("border-color",i.buffo&&i.buffo.x==a&&i.buffo.y==r?"black":i.bgReborde[r][a]?i.bgReborde[r][a].color:"black"),e.Q6J("ngClass",e.qlk(7,P,i.bgReborde[r][a]&&a-1>=0&&!i.bgReborde[r][a-1],i.bgReborde[r][a]&&a+1<i.bgReborde[0].length&&!i.bgReborde[r][a+1],i.bgReborde[r][a]&&r-1>=0&&!i.bgReborde[r-1][a],i.bgReborde[r][a]&&r+1<i.bgReborde.length&&!i.bgReborde[r+1][a],!i.bgReborde[r][a]&&a-1>=0&&i.bgReborde[r][a-1],!i.bgReborde[r][a]&&a+1<i.bgReborde[0].length&&i.bgReborde[r][a+1],!i.bgReborde[r][a]&&r-1>=0&&i.bgReborde[r-1][a],!i.bgReborde[r][a]&&r+1<i.bgReborde.length&&i.bgReborde[r+1][a]))}}function Z(n,o){if(1&n&&(e.TgZ(0,"span"),e.YNc(1,T,2,16,"span",1),e.qZA()),2&n){const t=o.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}class p{constructor(){}}function M(n,o){if(1&n&&e._UZ(0,"app-board",9),2&n){const t=e.oxw(2);e.Q6J("background",t.tablero.background)("bgReborde",t.tablero.bgReborde)("buffo",t.tablero.buffo)}}function A(n,o){if(1&n&&e._UZ(0,"app-board",10),2&n){const t=e.oxw(2);e.Q6J("background",t.nextPiece.bg)("bgReborde",t.nextPiece.bgReborde)}}function G(n,o){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Usuario"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Puntuaci\xf3n"),e.qZA()())}function J(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"(T\xfa)"),e.qZA())}function B(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.lobby.bot.nick),e.xp6(2),e.Oqu(t.lobby.bot.tablero.puntuacion)}}function U(n,o){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.YNc(3,J,2,0,"span",11),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA()(),e.YNc(6,B,5,2,"tr",11)),2&n){const t=o.$implicit,a=e.oxw(2);e.xp6(2),e.hij("",t.nick," "),e.xp6(1),e.Q6J("ngIf",t.nick==a.nick),e.xp6(2),e.Oqu(null==t.tablero?null:t.tablero.puntuacion),e.xp6(1),e.Q6J("ngIf",a.lobby.bot)}}function I(n,o){if(1&n&&e._UZ(0,"app-board",9),2&n){const t=e.oxw(2);e.Q6J("background",t.lobby.bot.tablero.background)("bgReborde",t.lobby.bot.tablero.bgReborde)("buffo",t.lobby.bot.tablero.buffo)}}function N(n,o){if(1&n&&(e.TgZ(0,"div",2),e.YNc(1,M,1,3,"app-board",3),e.TgZ(2,"div",4),e.YNc(3,A,1,2,"app-board",5),e.TgZ(4,"p-table",6),e.YNc(5,G,5,0,"ng-template",7),e.YNc(6,U,7,4,"ng-template",8),e.qZA()(),e.YNc(7,I,1,3,"app-board",3),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.tablero),e.xp6(2),e.Q6J("ngIf",t.nextPiece),e.xp6(1),e.Q6J("value",t.lobby.players),e.xp6(3),e.Q6J("ngIf",t.lobby.bot)}}p.\u0275fac=function(o){return new(o||p)},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-board"]],inputs:{background:"background",bgReborde:"bgReborde",buffo:"buffo"},decls:2,vars:1,consts:[[1,"tetris-board"],[4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Z,2,1,"span",1),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngForOf",t.background))},dependencies:[l.mk,l.sg],styles:[".tetris-board[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{display:flex;width:30%}.square[_ngcontent-%COMP%]{border:3px solid;width:50px;height:50px}.table-piece[_ngcontent-%COMP%]{display:block}.border-left[_ngcontent-%COMP%]{border-left-width:6px}.border-right[_ngcontent-%COMP%]{border-right-width:6px}.border-top[_ngcontent-%COMP%]{border-top-width:6px}.border-bottom[_ngcontent-%COMP%]{border-bottom-width:6px}.no-left[_ngcontent-%COMP%]{border-left-width:0}.no-right[_ngcontent-%COMP%]{border-right-width:0}.no-top[_ngcontent-%COMP%]{border-top-width:0}.no-bottom[_ngcontent-%COMP%]{border-bottom-width:0}.lessScore[_ngcontent-%COMP%]{background:repeating-radial-gradient(black,#9198e5 20%)!important}.x2[_ngcontent-%COMP%]{background:linear-gradient(to right,red,orange,yellow,green,blue,indigo,violet)!important}.slow[_ngcontent-%COMP%]{background:radial-gradient(#f69d3c,red)!important}.stopDiece[_ngcontent-%COMP%]{background:linear-gradient(to right,indigo,violet,blue,indigo)!important}"]});class m{constructor(o,t){this.route=o,this.gwService=t,this.blockedDocument=!0,this.nick=localStorage.getItem("nick")}ngOnInit(){this.route.paramMap.subscribe(o=>{this.instanceWS(o.get("id"))}),document.addEventListener("keydown",o=>{switch(o.key){case"ArrowUp":this.ws.send("up");break;case"ArrowDown":this.ws.send("down");break;case"ArrowLeft":this.ws.send("left");break;case"ArrowRight":this.ws.send("right")}})}instanceWS(o){this.ws&&this.ws.close();let t=this.gwService.getAvailableServer(o);console.log(t),this.ws=new C.WebsocketBuilder(`${t}game/${this.nick}/${o}`).onOpen((a,r)=>{console.log("ABIERTO")}).onClose((a,r)=>{console.log("CLOSED")}).onError((a,r)=>{console.log("error")}).onMessage((a,r)=>{this.onMessage(JSON.parse(r.data))}).build()}onMessage(o){this.lobby=o,this.lobby.estado==_.G[_.G.RUNNING]&&(this.blockedDocument=!1),this.tablero=this.lobby.players.find(t=>t.nick==this.nick)?.tablero,this.createNextPieceBoard()}createNextPieceBoard(){let o=[],t=[];if(this.tablero&&this.tablero.nextPiece){for(let r=0;r<this.tablero.nextPiece.height+2;r++){let i=[],u=[];for(let f=0;f<this.tablero.nextPiece.width+2;f++)i.push("gray"),u.push(new v.L("black"));o.push(i),t.push(u)}this.tablero.nextPiece.coordenadas.forEach(r=>{this.tablero&&(o[r[1]+1][r[0]+1]=this.tablero.nextPiece.color,t[r[1]+1][r[0]+1]=this.tablero.nextPiece.reborde)}),this.nextPiece={bg:o,bgReborde:t}}}}m.\u0275fac=function(o){return new(o||m)(e.Y36(h.gz),e.Y36(k.J))},m.\u0275cmp=e.Xpm({type:m,selectors:[["app-game"]],decls:2,vars:2,consts:[["message","Esperando a que se conecten todos los jugadores",3,"blocked"],["class","container",4,"ngIf"],[1,"container"],[3,"background","bgReborde","buffo",4,"ngIf"],[1,"table-piece"],[3,"background","bgReborde",4,"ngIf"],[3,"value"],["pTemplate","header"],["pTemplate","body"],[3,"background","bgReborde","buffo"],[3,"background","bgReborde"],[4,"ngIf"]],template:function(o,t){1&o&&(e._UZ(0,"app-blocked",0),e.YNc(1,N,8,4,"div",1)),2&o&&(e.Q6J("blocked",t.blockedDocument),e.xp6(1),e.Q6J("ngIf",t.lobby&&!t.blockedDocument))},dependencies:[l.O5,w.iA,y.jx,g,p],styles:[".container[_ngcontent-%COMP%]{display:inline-flex;width:100%}.container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-inline:5%;max-width:50%}"]});var F=c(6173);class d{}d.\u0275fac=function(o){return new(o||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[h.Bz.forChild([{path:":id",component:m,canActivate:[F.V]},{path:"**",redirectTo:"/lobby/create",pathMatch:"full"}]),h.Bz]});var Q=c(4466),Y=c(529);class s{}s.\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({providers:[b,k.J],imports:[l.ez,d,Q.m,Y.JF]})}}]);